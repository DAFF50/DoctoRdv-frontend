<div class="container">
  <!-- Header -->
  <div class="header">
    <h1>üìÖ Prendre Rendez-vous</h1>
    <p>R√©servez votre consultation en quelques clics</p>
  </div>

  <!-- Grille principale -->
  <div class="booking-container">

    <!-- Carte Informations du m√©decin - GAUCHE -->
    <div class="doctor-card">
      <div class="doctor-header">
        <div class="doctor-avatar">
          DR
        </div>
        <div class="doctor-details">
          <h2>Dr. {{ medecin?.prenom }} {{ medecin?.nom }}</h2>
          <p class="doctor-specialty">ü©∫ {{ medecin?.specialite?.libelle }}</p>
          <div class="doctor-rating">
          </div>
        </div>
      </div>

      <!-- Horaires -->
      <div class="info-section">
        <h3>üïê Horaires de consultation</h3>
        <div class="schedule-list">
          <div *ngFor="let jour of joursOrdonnes" class="schedule-item" [class.closed]="isJourFerme(jour)">
            <span class="day">{{ jour }}</span>
            <span class="hours">{{ formatHorairesJour(jour) }}</span>
          </div>
        </div>
      </div>

      <!-- Tarifs -->
      <div class="info-section pricing-section">
        <h3>üí∞ Tarif de consultation</h3>
        <div class="price-card">
          <div class="price-amount">{{ medecin?.specialite?.tarif | number:'1.0-0' }} FCFA</div>
          <p class="price-note">Paiement en ligne ou au cabinet</p>
        </div>
      </div>
    </div>

    <!-- Formulaire de r√©servation - DROITE -->
    <div class="booking-form">
      <form [formGroup]="formRendezVous" (ngSubmit)="onSubmit()">

        <!-- √âtape 1: Informations personnelles -->
        <div class="form-section">
          <div class="section-header">
            <h3>üë§ Informations personnelles</h3>
            <p class="section-subtitle">vous pouvez modifier vos coordonn√©es dans profil</p>
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label>Pr√©nom <span class="required">*</span></label>
              <input type="text" [value]="currentUser?.prenom || ''" disabled/>
            </div>

            <div class="form-group">
              <label>Nom <span class="required">*</span></label>
              <input type="text" [value]="currentUser?.nom || ''" disabled/>
            </div>

            <div class="form-group">
              <label>Email <span class="required">*</span></label>
              <input type="email" [value]="currentUser?.email || ''" disabled/>
            </div>

            <div class="form-group">
              <label>T√©l√©phone <span class="required">*</span></label>
              <input type="tel" [value]="currentUser?.telephone || ''" disabled/>
            </div>

            <div class="form-group">
              <label>Date de naissance <span class="required">*</span></label>
              <input type="date" [value]="currentUser?.dateNaissance || ''" disabled/>
            </div>

            <div class="form-group">
              <label>Genre <span class="required">*</span></label>
              <select [value]="currentUser?.genre || ''" disabled>
                <option value="">S√©lectionner...</option>
                <option value="Homme">Masculin</option>
                <option value="Femme">F√©minin</option>
              </select>
            </div>

            <div class="form-group full-width">
              <label>Motif de la consultation <span class="required">*</span></label>
              <textarea formControlName="motif" placeholder="D√©crivez bri√®vement la raison de votre consultation..." rows="4"></textarea>
              <div *ngIf="submitted && f2['motif'].errors" class="error-message">
                <span class="text-danger" *ngIf="f2['motif'].errors['required']">‚ö†Ô∏è Le motif de consultation est obligatoire</span>
                <span class="text-danger" *ngIf="f2['motif'].errors['maxlength']">‚ö†Ô∏è Le motif ne doit pas d√©passer 255 caract√®res</span>
              </div>
            </div>
          </div>
        </div>

        <!-- √âtape 2: Date et heure -->
        <div class="form-section">
          <div class="section-header">
            <h3>üìÖ Choisir la date et l'heure</h3>
            <p class="section-subtitle">S√©lectionnez un cr√©neau disponible</p>
          </div>

          <div class="datetime-container">
            <div class="form-group">
              <label>Date du rendez-vous <span class="required">*</span></label>
              <input type="date" (change)="onDateChange($event)" formControlName="dateRdv"/>
              <div *ngIf="submitted && f2['dateRdv'].errors" class="error-message">
                <span class="text-danger" *ngIf="f2['dateRdv'].errors['required']">‚ö†Ô∏è Veuillez s√©lectionner une date</span>
              </div>
            </div>

            <div class="form-group">
              <label>Cr√©neau horaire <span class="required">*</span></label>
              <div class="time-slots">
                <button *ngFor="let creneau of creneauxDisponibles"
                        type="button"
                        class="time-slot"
                        [class.selected]="isCreneauSelected(creneau)"
                        (click)="selectHeure(creneau)">
                  {{ creneau }}
                </button>
              </div>

              <!-- Messages d'information et d'erreur -->
              <div class="time-slot-messages">
                <div *ngIf="submitted && f2['heure'].errors" class="error-message">
                  <span class="text-danger" *ngIf="f2['heure'].errors['required']">‚ö†Ô∏è Veuillez s√©lectionner un cr√©neau horaire</span>
                </div>
                <p *ngIf="dateSelectionnee && creneauxDisponibles.length === 0" class="info-message warning">
                  ‚ÑπÔ∏è Aucun cr√©neau disponible pour cette date
                </p>
                <p *ngIf="!dateSelectionnee" class="info-message">
                  ‚ÑπÔ∏è Veuillez d'abord s√©lectionner une date
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- √âtape 3: Mode de paiement -->
        <div class="form-section">
          <div class="section-header">
            <h3>üí≥ Mode de paiement</h3>
            <p class="section-subtitle">Choisissez votre m√©thode de paiement</p>
          </div>

          <div class="payment-options">
            <label class="payment-option" [class.selected]="formRendezVous.get('modePaiement')?.value === 'en ligne'">
              <input type="radio" formControlName="modePaiement" name="paymentMode" value="en ligne"/>
              <div class="payment-icon">üí≥</div>
              <div class="payment-details">
                <h4>Paiement en ligne</h4>
                <p>Carte bancaire, Mobile Money (Orange Money, Wave)</p>
              </div>
              <div class="payment-badge">S√©curis√©</div>
            </label>

            <label class="payment-option" [class.selected]="formRendezVous.get('modePaiement')?.value === 'cabinet'">
              <input type="radio" formControlName="modePaiement" name="paymentMode" value="cabinet"/>
              <div class="payment-icon">üíµ</div>
              <div class="payment-details">
                <h4>Paiement au cabinet</h4>
                <p>R√©glez en esp√®ces directement √† la clinique</p>
              </div>
              <div class="payment-badge recommended">Recommand√©</div>
            </label>
          </div>
        </div>

        <!-- R√©sum√© de la r√©servation -->
        <div class="booking-summary">
          <h4>üìã R√©sum√© de votre rendez-vous</h4>
          <div class="summary-content">
            <div class="summary-item">
              <span class="summary-label">M√©decin :</span>
              <span class="summary-value">Dr. {{ medecin?.prenom }} {{ medecin?.nom }}</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">Sp√©cialit√© :</span>
              <span class="summary-value">{{ medecin?.specialite?.libelle }}</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">Date :</span>
              <span class="summary-value">{{ formRendezVous.get('dateRdv')?.value || 'Non s√©lectionn√©e' }}</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">Heure :</span>
              <span class="summary-value">{{ formRendezVous.get('heure')?.value || 'Non s√©lectionn√©e' }}</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">Mode de paiement :</span>
              <span class="summary-value">{{ formRendezVous.get('modePaiement')?.value === 'en ligne' ? 'En ligne' : 'Au cabinet' }}</span>
            </div>
            <div class="summary-item total">
              <span class="summary-label">Total √† payer :</span>
              <span class="summary-value">{{ medecin?.specialite?.tarif | number:'1.0-0' }} FCFA</span>
            </div>
          </div>
        </div>

        <!-- Actions -->
        <div class="form-actions">
          <button routerLink="/patient/list-medecin" type="button" class="btn btn-secondary">
            ‚Üê Retour
          </button>
          <button type="submit" class="btn btn-primary">
            Confirmer le rendez-vous ‚Üí
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
